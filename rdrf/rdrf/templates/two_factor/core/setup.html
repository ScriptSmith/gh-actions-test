{% extends "two_factor/_base_focus.html" %}
{% load i18n %}

{% block content %}
  <form action="" method="post">
    {% csrf_token %}
      <div class="panel panel-default">
        <div class="panel-heading">{% trans "Enable Two-Factor Authentication" %}</div>
        <div class="panel-body">
          <div class="row">
            {% if wizard.steps.current == 'welcome' %}
              <div class="col-xs-12">
                <p>{% blocktrans %}You are about to take your account security to the next level. Follow the steps in this wizard to enable two-factor authentication.{% endblocktrans %}</p>
              </div>
            {% elif wizard.steps.current == 'generator' %}
              <div class="col-xs-12">
                <p>{% blocktrans %}To start using a token generator, please use your smartphone to scan the QR code below. For example, use Google Authenticator. Then, enter the token generated by the app.{% endblocktrans %}</p>
              </div>
              <div class="col-xs-12">
                <img class="center-block" src="{{ QR_URL }}" alt="QR Code" />
              </div>
              <div class="col-xs-12">
                <p>{% blocktrans %}For manual setup use the time-based key below:{% endblocktrans %}</p>

                <div class="lead">{{ request.session.two_fact_auth_key }}</div>
              </div>
            {% endif %}
          </div>

          {% if form.token.errors %}
            <div class="row">
              <div class="col-xs-12">
                <div class="alert alert-danger" role="alert">
                  <div class="alert-text"></div>
                  <div class="row">
                    {% if form.token.errors|length > 1 %}
                      <ul>
                        {% for err in form.token.errors %}
                          <li>{{ err }}</li>
                        {% endfor %}
                      </ul>
                    {% else %}
                      {% for err in form.token.errors %}
                        <div class="text-center">{{ err }}</div>
                      {% endfor %}
                    {% endif %}
                  </div>
                </div>
              </div>
            </div>
          {% endif %}

          {% if wizard.steps.current == 'generator' %}
            <input type="hidden" name="setup_view-current_step" value="generator" id="id_setup_view-current_step">

            <div class="form-group">
              <label for="id_generator-token">{% trans "Token:" %}</label>
              <input class="form-control" type="number" name="generator-token" autofocus="autofocus" value="{{ form.token.value|default:"" }}" min="1" max="99999999" id="id_generator-token">
            </div>
          {% else %}
            {% include "two_factor/_wizard_forms.html" %}
          {% endif %}

          {# hidden submit button to enable [enter] key #}
          <div style="display: none"><input type="submit" value=""/></div>

          <div class="row">
            <div class="col-sm-12">
              {% include "two_factor/_wizard_actions.html" %}
            </div>
          </div>
        </div>
      </div>
  </form>

{% endblock %}
