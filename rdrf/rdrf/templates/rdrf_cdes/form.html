{% load staticfiles %}
{% load get_form %}
{% load get_forms %}
{% load is_formset %}
{% load get_elements %}
{% load get_display_name %}
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
<title>{{registry|upper}} Registry</title>
<link rel="stylesheet" type="text/css" href="{% static 'css/registry.css' %}"/>
<link rel="stylesheet" type="text/css" href="/static/admin/css/forms.css">
<link rel="stylesheet" type="text/css" href="/static/admin/css/base.css">
<script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js" ></script>
<script src="//cdnjs.cloudflare.com/ajax/libs/underscore.js/1.5.2/underscore-min.js"></script>
<script type="text/javascript" src="{% static 'js/calculated_field_plugin.js' %}"></script>
<!--[if IE 6]>
<link rel="stylesheet" type="text/css" href="{% static 'css/ie6.css' %}"/>
<![endif]-->
<!--[if IE 7]>
<link rel="stylesheet" type="text/css" href="{% static 'css/ie7.css' %}"/>
<![endif]-->
</head>
<body>
  <!-- Header -->
    <div id="header">
        <div id="branding">
            <h1 id="site-name">{{registry|upper}} Registry</h1>
        </div>

        <div id="user-tools">
            Welcome,
            <strong>admin</strong>.
                <a href="/admin/password_change/">Change password</a> /
                <a href="/admin/logout/">Log out</a>
        </div>
    </div>
    <!-- END Header -->

    <div id="content" class="colM">
    {% if messages %}
    <ul class="messagelist">
        {% for message in messages %}
            <li{% if message.tags %} class="{{ message.tags }}"{% endif %}>{{ message }}</li>
        {% endfor %}
    </ul>
    {% endif %}
        <h2>Patient: <a href="{% url 'admin:patients_patient_change' patient_id %}">{{ patient_name }}</a></h2>
            
            <div id="content-main">
                <form action="/{{registry}}/forms/{{form_name}}/{{patient_id}}" method="post">{% csrf_token %}
                    {% for s in sections %}
                        <div class="inline-group">
                            <h2>{{display_names|get_display_name:s}} </h2>
                            {% if forms|is_formset:s %}
                                {% autoescape off %}
                                <div class="actionbutton" onclick="add_form(this,{{section_element_map|get_elements:s}});">Add</div> <div class="actionbutton" onclick="remove_form(this, {{section_element_map|get_elements:s}});">Remove</div>
                                {% endautoescape %}
                                <table>
                                {% for f in forms|get_forms:s %}
                                    {{f.as_table}}
                                {% endfor %}

                                </table>
                            {% else %}
                                <table>
                                {{forms|get_form:s}}
                                </table>
                            {% endif %}
                        </div>
                        <!--<fieldset><legend>{{s}}</legend>
                        </fieldset>-->
                    {% endfor %}
                    <input type="submit" value="Submit" />
                </form>
            </div>
    </div>


    {% if form.errors %}
    {% for field in form %}
        {% for error in field.errors %}
            <div class="alert alert-error">
                <strong>{{ error|escape }}</strong>
            </div>
        {% endfor %}
    {% endfor %}
    {% for error in form.non_field_errors %}
        <div class="alert alert-error">
            <strong>{{ error|escape }}</strong>
        </div>
    {% endfor %}
{% endif %}
</body>
</html>