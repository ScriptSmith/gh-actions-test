{% extends "registration/registration_base.html" %}

{% load i18n %}
{% load countries %}
{% load project_title %}
{% load recaptcha_site_key %}

{% block extra_js_init %}
    $("#id_date_of_birth").datepicker(dateOptions);
    $("#id_parent_guardian_date_of_birth").datepicker(dateOptions);

    setStatesOnLoad("#id_country");
    setUpStateOnCountryChange("#id_country", "#id_state");
    setStatesOnLoad("#id_parent_guardian_country");
    setUpStateOnCountryChange("#id_parent_guardian_country", "#id_parent_guardian_state");

    $("#id_same_address").on("click", function() {
        var self = this;
        $("#patient-address-div").slideToggle("fast", function() {
            var disabled = $(self).prop('checked');
            $("#id_address").prop("disabled", disabled);
            $("#id_suburb").prop("disabled", disabled);
            $("#id_country").prop("disabled", disabled);
            $("#id_state").prop("disabled", disabled);
            $("#id_postcode").prop("disabled", disabled);
        });
    });

{% endblock %}

{% block content %}

    <h3>
        <strong>{% project_title %} - {% trans "Parent Registration" %}</strong>
    </h3>

    <div class="alert alert-danger" style="display: none" id="username-error">
        <p>
            <b>{% trans "Username error:  This username already exists, please choose a different username." %}</b>
        </p>
        <p>
            {% trans "If you have already registered and would like to update your data or add another patient, you don't have to register again. Just go to the login page and login with the e-mail address and password you previously registered with." %}
        </p>
        <p>
            {% trans "If you have forgotten your password, please  click on 'forgotten your password?'" %}
        </p>
    </div>

    <div class="alert alert-warning">
        <strong>{% trans "Parent/Guardians" %}</strong>:
        {% trans "You may register one patient at this stage - if you have multiple patients to register, you will be able to enter their details once you have logged into the registry. Please note you must be the patient's parent or guardian to register on their behalf." %}
    </div>

    <div class="alert alert-info">
        <small>
            <p class="text-justify text-muted">
                {% trans "Privacy Statement - All information we receive from you will be treated confidentially and will be encrypted and stored on a secure server. Only de-identified health information will be made accessible to qualified researchers who are granted permission by the Steering committee." %}
            </p>
        </small>
    </div>

    <div id="form-invalid" class="alert alert-danger" style="display: none">
        {% trans "Please fill out all required fields" %}
    </div>

    <form id="registration-form" method="POST">
        {% csrf_token %}
        <div class="row">

            <div class="col-md-6">
                {% include "registration/registration_login_details.html" %}
            </div>

            <div class="col-md-6">
                <input type="hidden" name="registry_code" value="{{registry_code}}">
                <input id="id_email" name="email" type="hidden" />

                <div id="the-form">
                    <h2>{% trans "Parent/Guardian Details" %}</h2>
                    <div id="parent_guardian_form">
                        <div class="form-group">
                            {{form.parent_guardian_first_name}}
                        </div>
                        <div class="form-group">
                            {{form.parent_guardian_last_name}}
                        </div>
                        <div class="form-group">
                            {{form.parent_guardian_date_of_birth}}
                            <div class="text-muted">YYYY-MM-DD</div>
                        </div>
                        <div class="form-group">
                            <fieldset data-toggle="tooltip" data-placement="left" title="{% trans 'Indeterminate also refers to Intersex/Unspecified' %}">
                            {{form.parent_guardian_gender}}
                            </fieldset>
                        </div>
                        <div class="form-group top-separator">
                            {{form.parent_guardian_address}}
                        </div>
                        <div class="form-group">
                            {{form.parent_guardian_suburb}}
                        </div>
                        <div class="form-group">
                            {{form.parent_guardian_country}}
                        </div>
                        <div class="form-group">
                            {{form.parent_guardian_state}}
                        </div>
                        <div class="form-group">
                            {{form.parent_guardian_postcode}}
                        </div>
                        <div class="form-group">
                            {{form.parent_guardian_phone}}
                        </div>
                    </div>

                    <h2>{% trans "Patient Details" %}</h2>
                    {% include "registration/registration_patient_details.html" %}
                    <div class="form-group top-separator">
                        {{form.same_address}} {% trans "Same details as person completing" %}
                    </div>
                    {% include "registration/registration_patient_address.html" %}
                    </div>
                </div>


                <br>

                <div class="row">
                    <div class="col-md-6">
                        <div class="g-recaptcha" data-sitekey="{% recaptcha_site_key %}"  data-callback='reCaptchaCallback'></div>
                    </div>
                    <div class="col-md-6">
                        <button type="button" id="registration-submit" class="btn btn-success pull-right">Submit</button>
                    </div>
                </div>


            </div>

        </div>
    </form>

{% endblock %}